```{r}
library(tidyverse)
library(lda.svi)
```

```{r,cache=TRUE}
bench::system_time(lda_fit <-
                     lda_vi(reddit_tidy[, c(2, 1, 3)], K = 100, passes = 1))
```

At this point it's quite clear that this implementation isn't doing quite the same thing as the python one

```{r}
beta <- lda_fit$beta %>% reshape2::melt() %>% transmute(topic=Var1,term=Var2,beta=value)

theta <- lda_fit$theta %>% as.data.frame() %>% rownames_to_column('document') %>% gather(-document,key='topic',value='theta')
# theta
```

```{r}
beta %>%
  group_by(topic) %>%
  arrange(desc(beta)) %>%
  filter(row_number() <= 15) %>%
  arrange(desc(beta)) %>%
  ggplot(aes(term,beta)) +
    geom_col() + 
  coord_flip() +
  theme_minimal() +
  facet_wrap(~topic,scales='free')
```

```{r}
#apply(lda_fit$gamma,FUN=function(x)x/sum(x),MARGIN=1) %>%
#  colSums()
```

